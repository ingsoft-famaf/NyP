{% extends "base.html" %}
{% block content %}
  <div class="page-header">
    <h1>{{ subject.name }} <small style="font-size: 0.5em"> {{ subject.description}}</small></h1>
  </div>
  <div class="row">
    <div class="col-lg-3" style="background: #EEE; border-radius: 12px;">
      <h4>General Stats</h4>
      <dl>
      {% for key, value in general_stats %}
        <dt>{{ key }}</dt>
        <dd>{{ value }}</dd>
      {% endfor %}
      </dl>
    </div>
    <div class="col-lg-9">
        <canvas id="performance_chart" width="100" height="47"></canvas>

    </div>
  </div>
  <hr>
  <div class="row">
    <h2>History of quizes</h2>
    {% if quizes %}
      {% for quiz in quizes %}
        <div class="list-group">
          {% if quiz.state == 'finished' %}
            <a href="{% url 'quiz_results' quiz.id %}" class="list-group-item" title="Quiz details">
          {% elif quiz.state == 'in_progress' %}
            {# by goint to new_quiz, user will be forced to resume or discard the pending quiz #}
            <a href="{% url 'new_quiz' %}" class="list-group-item">
          {% else %}
            <a class="list-group-item disabled" title="Aborted quiz">
          {% endif %}
              {{ quiz.datetime }},
              {% with quiz.score as score %}
                {% if score < 40 %}
                  <span class="label label-danger" style="float: right; font-size: 0.8em">{{ score|floatformat:2 }} %</span>
                {% elif score <= 70 %}
                  <span class="label label-warning" style="float: right; font-size: 0.8em">{{ score|floatformat:2 }} %</span>
                {% else %}
                  <span class="label label-success" style="float: right; font-size: 0.8em">{{ score|floatformat:2 }} %</span>
                {% endif %}
              {% endwith %}
            </h4>
          </a>
        </div>
      {% endfor %}
    {% else %}
      <p>
        <span class="glyphicon glyphicon-arrow-right"></span>
        No quizes yet, start practicing {{ subject }}
        <a href="{% url 'new_quiz' %}">now</a>
      </p>
    {% endif %}
  </div>

{% endblock %}

        {% block custom_js %}
            <script src="/static/js/moment.js"></script>
            <script src="/static/js/Chart.js"></script>
              <script>
              var ctx = document.getElementById("performance_chart");
              var date_times = {{ quizes_dates | safe}};
              var avgs = {{ quizes_avg }};
              var performance_chart = new Chart(ctx, {
                  type: 'line',
                  data: {
                      labels: date_times,
                      datasets: [{
                        //cubicInterpolationMode: 'monotone',
                        lineTension: 0.08,
                        label: 'Your Performance',
                        data: avgs,
                        borderWidth: 2,
                        borderColor: [
                            'rgba(75, 192, 192, 1)',

                        ],
                        backgroundColor: [ 
                            'rgba(206, 206, 206, 0.5)',
                        ],
                      }]
                  },
                  options: {
                      legend: {
                          display: false,
                      },
                      title: {
                          display: false,
                          text: "Quiz Performance vs Datetime"
                      },
                      responsive: true,
                      maintainAspectRatio: true,
                      scales: {
                          yAxes: [{
                              ticks: {
                                  beginAtZero:true,
                                  max: 100,
                              }
                          }],
                          xAxes: [{
                              type: 'time',
                              unit: 'day',
                              unitStepSize: 1,
                              time: {
                              unit: 'day',
                                  displayFormats: {
                                      'day': 'MMM DD, YYYY'
                                  } 
                              }
                          }]
                      }
                  }
              });
              </script>
        {% endblock %}
